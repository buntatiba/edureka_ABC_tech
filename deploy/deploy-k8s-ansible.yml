- hosts: "{{ env }}"
  become: yes
  tasks: 
    - name: Deploying Application pods...
      shell: | 
          if [ $(kubectl get deployment | grep -v NAME | awk '{print $1}' | grep abctechnologies-1-0 | wc -l) -gt 0 ]; then
             echo "Deleting previous application deployment"
             kubectl delete deployment $(kubectl get deployment | grep -v NAME | awk '{print $1}' | grep abctechnologies-1-0)
             echo "Creating new application deployment"
             kubectl apply -f $WORKSPACE/deploy/abctechnologies-deploy-k8s.yml
          else
             echo "Deploying abctechnologies-1-0 Application"
             kubectl apply -f $WORKSPACE/deploy/abctechnologies-deploy-k8s.yml
          fi
    - name: deploying service
      shell: |
         if [ `kubectl get svc | grep abctechnologies-1-0  | awk '{print $1}' | wc -l` -gt 0 ]; then
            echo "app service found, No actions taken"
            kubectl delete svc `kubectl get svc | grep abctechnologies-1-0 | awk '{print $1}'`
            echo "creating new service"
            kubectl apply -f $WORKSPACE/deploy/abctech-svc-k8s.yml
         else
            echo "Creating App Services"
            kubectl apply -f $WORKSPACE/deploy/abctech-svc-k8s.yml
         fi
    - name: increase replicas 
      shell: kubectl scale deploy abctechnologies-1-0 --replicas=2
      